var gkSound=function(){"use strict";var k,l,a=[],b=[],c=[],d=[],e=null,f=100,g=null,h=1,i=null,m='<div class="btnImage" style="left:0"></div>',n='<div class="btnImage" style="left:-100%"></div>',o=function(){var a=document.createElement("div");a.id="sounds",document.body.appendChild(a)},p=function(a){var b=document.createElement("div"),c=document.createElement("div");b.id="btnMute",c.class="btnImage",b.appendChild(c),void 0!==a?a.appendChild(b):document.body.appendChild(b),k="btnMute",document.getElementById(k).addEventListener("click",function(){gkSound.toggleSounds()})},q=function(a){void 0!==k&&(document.getElementById(k).innerHTML=a===!0?m:n)},r=function(){(""!==localStorage.musicStatus||null!==localStorage.musicStatus)&&("mute"===localStorage.musicStatus?(gkSound.stopAllSounds(),q(!1),l=!1):(localStorage.musicStatus="on",q(!0),l=!0))},s=function(c){var e,d=!1;for(e=a.length-1;e>=0;e--)if(a[e].id===c){d=!0;break}for(e=b.length-1;e>=0;e--)if(b[e].id===c){d=!0;break}return d},t=function(a){var b,c,d;return d=1==gkSound.hasMP3Support()?".mp3":".ogg",-1!==a.search(".mp3")?(c=a.split(".mp3"),d=".mp3"):-1!==a.search(".ogg")?(c=a.split(".ogg"),d=".ogg"):c=null,b=null!==c?c[0]+d+(c[1]?c[1]:""):a+d},u=function(){var a,b,c,f,g,j,k,h=e.style.left.replace("px",""),i=e.style.top.replace("px","");for(j=d.length-1;j>=0;j--)for(k=d[j].sounds.length-1;k>=0;k--)a=d[j].sounds[k],f=d[j].left,g=d[j].top,b=(f-h>0?f-h:h-f)+(g-i>0?g-i:i-g),d[j].range>b?(c=1-b/d[j].range,c=0>c?-1*c:c):c=0,a.volume=c};return{init:function(a,b){o(),a===!0&&p(b),r()},hasMP3Support:function(){var a=document.createElement("audio");return!(!a.canPlayType||!a.canPlayType("audio/mpeg;").replace(/no/,""))},hasOGGSupport:function(){var a=document.createElement("audio");return!(!a.canPlayType||!a.canPlayType("audio/ogg;").replace(/no/,""))},addSound:function(c,d,e,f,g){if("string"!=typeof c||"string"!=typeof d)return console.info("Warning! Please, check parameters to gkSound.addSound method."),null;var h,i=function(){f===!0&&(e===!1?gkSound.playTrack():gkSound.playTrack())},j=function(a){void 0!==g&&g(a)};s(c)?j({message:"Sound already exists.",code:-1}):(h=new Audio(t(d)),h.setAttribute("id",c),e?(h.setAttribute("loop","loop"),b.push(h)):a.push(h),document.getElementById("sounds").appendChild(h),h.addEventListener("canplaythrough",function(){i(),j({message:"Sound loaded.",code:0})},!1),h.addEventListener("error",function(){gkSound.removeSound(c),console.error("Error! Code: "+h.error.code+". For more information see http://www.w3.org/html/wg/drafts/html/master/embedded-content-0.html#dom-media-error"),j({message:"Error! For more information see http://www.w3.org/html/wg/drafts/html/master/embedded-content-0.html#dom-media-error",code:h.error.code})},!1))},removeSound:function(c){for(var e,d=0;void 0===e||a.length>d;)a[d].id===c&&(e=a[d],a.splice(d,1)),d++;for(d=0;void 0===e||b.length>d;)b[d].id===c&&(e=b[d],b.splice(d,1)),d++;return void 0===e?(console.info("Warning! Sound not exists to be removed by gkSound.removeSound method."),{message:"Sound not exists.",code:-1}):(e.parentNode.removeChild(e),{message:"Sound removed.",code:0})},addSoundListener:function(a){e=a,null!==g&&clearInterval(g),g=setInterval(u,f)},addSoundEmitter:function(a){d.push(a)},attachToSoundEmitter:function(a,b){var c;for(c=d.length-1;c>=0;c--)if(d[c].id===a){d[c].sounds.push(document.getElementById(b));break}},playSound:function(a,b,c,d){var e=document.getElementById(a),d=void 0===d?!1:d,f=function(a){void 0!==c&&c(a)},g=function(){e.removeEventListener("ended",g),e.playing=!1,f({message:"Sound played.",code:0})};if(l||d){if(b)try{e.play(),e.currentTime=0}catch(h){e.play()}else e.play();e.playing=!0,e.addEventListener("ended",g,!1)}else f({message:"Sound was muted.",code:-1})},resumeAllSounds:function(){var a;for(a=c.length-1;a>=0;a--)document.getElementById(c[a]).play()},pauseSound:function(a){document.getElementById(a).pause()},pauseAllSounds:function(){var b;for(null!==i&&(gkSound.pauseSound(i),c.push(i)),b=a.length-1;b>=0;b--)gkSound.pauseSound(a[b].id),document.getElementById(a[b].id).playing===!0&&c.push(a[b].id)},stopSound:function(a){var b=document.getElementById(a);try{b.play(),b.currentTime=0,b.pause()}catch(c){b.pause()}},stopAllSounds:function(){var b;for(null!==i&&(gkSound.stopSound(i),i=null),b=a.length-1;b>=0;b--)gkSound.stopSound(a[b].id)},playTrack:function(){var a;if(l)for(a=b.length-1;a>=0;a--)document.getElementById(b[a].id).play(),i=b[a].id},stopTrack:function(){null!==i&&(gkSound.stopSound(i),i=null)},toggleSounds:function(){"mute"===localStorage.musicStatus?(l=!0,localStorage.musicStatus="on",q(!0),gkSound.playTrack()):(l=!1,localStorage.musicStatus="mute",q(!1),gkSound.stopAllSounds())},setGlobalVolume:function(c,d){var e,f;for(d=d?!0:!1,h=c,f=a.length-1;f>=0;f--)e=d===!0?a[f].volume*h:c,a[f].volume=e;for(f=b.length-1;f>=0;f--)e=d===!0?b[f].volume*h:c,b[f].volume=e},getGlobalVolume:function(){return h},setVolume:function(a,b,c){c=void 0===c?!1:!0;var d=c===!0?b*h:b;document.getElementById(a).volume=d},getVolume:function(a){return document.getElementById(a).volume}}}();