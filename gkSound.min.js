var gkSound=function(){var k,l,a=[],b=[],c=[],d=[],e=null,f=100,g=null,h=1,i=null,m='<div class="btnImage" style="left:0"></div>',n='<div class="btnImage" style="left:-100%"></div>',o=function(){document.body.innerHTML+='<div id="sounds" style="display:none"></div>'},q=function(){(""!=localStorage.musicStatus||null!=localStorage.musicStatus)&&("mute"==localStorage.musicStatus?(gkSound.stopAllSounds(),document.getElementById(k).innerHTML=n,l=!1):(localStorage.musicStatus="on",document.getElementById(k).innerHTML=m,l=!0))},r=function(c){for(var d=!1,e=a.length-1;e>=0;e--)if(a[e].id==c){d=!0;break}for(var e=b.length-1;e>=0;e--)if(b[e].id==c){d=!0;break}return d},s=function(a){var b,c,d;return d=1==gkSound.hasMP3Support()?".mp3":".ogg",-1!=a.search(".mp3")?(c=a.split(".mp3"),d=".mp3"):-1!=a.search(".ogg")?(c=a.split(".ogg"),d=".ogg"):c=null,b=null!=c?c[0]+d+(c[1]?c[1]:""):a+d},t=function(){for(var a,b,f,g,h,i=e.style.left.replace("px",""),j=e.style.top.replace("px",""),k=d.length-1;k>=0;k--)for(var l=d[k].sounds.length-1;l>=0;l--)a=d[k].sounds[l],g=d[k].left,h=d[k].top,b=(g-i>0?g-i:i-g)+(h-j>0?h-j:j-h),d[k].range>b?(f=1-b/d[k].range,f=0>f?-1*f:f):f=0,a.volume=f};return{init:function(a,b){o(),1==a?(void 0==b?a():k=b,document.getElementById(k).addEventListener("click",function(){gkSound.toggleSounds()}),q()):(localStorage.musicStatus="on",l=!0)},hasMP3Support:function(){var a=document.createElement("audio");return!(!a.canPlayType||!a.canPlayType("audio/mpeg;").replace(/no/,""))},hasOGGSupport:function(){var a=document.createElement("audio");return!(!a.canPlayType||!a.canPlayType("audio/ogg;").replace(/no/,""))},addSound:function(c,d,e,f,g){var h=function(){1==f&&(0==e?gkSound.playTrack():gkSound.playTrack())},i=function(a){void 0!=g&&g(a)};if(r(c))i({message:"Sound already exists.",code:-1});else{var j=new Audio(s(d));j.setAttribute("id",c),e?(j.setAttribute("loop","loop"),b.push(j)):a.push(j),document.getElementById("sounds").appendChild(j),j.addEventListener("canplaythrough",function(){h(),i({message:"Sound loaded.",code:0})},!1),j.addEventListener("error",function(){gkSound.removeSound(c),i({message:"Error! For more information see http://www.w3.org/html/wg/drafts/html/master/embedded-content-0.html#dom-media-error",code:j.error.code})},!1)}},removeSound:function(c){for(var d=0,e=void 0;void 0==e||a.length>d;)a[d].id==c&&(e=a[d],a.splice(d,1)),d++;for(d=0;void 0==e||b.length>d;)b[d].id==c&&(e=b[d],b.splice(d,1)),d++;return void 0==e?{message:"Sound not exists.",code:-1}:(e.parentNode.removeChild(e),{message:"Sound removed.",code:0})},addSoundListener:function(a){e=a,null!=g&&clearInterval(g),g=setInterval(t,f)},addSoundEmitter:function(a){d.push(a)},attachToSoundEmitter:function(a,b){for(var c=d.length-1;c>=0;c--)if(d[c].id==a){d[c].sounds.push(document.getElementById(b));break}},playSound:function(a,b,c){var d=document.getElementById(a),e=function(a){void 0!=c&&c(a)},f=function(){d.removeEventListener("ended",f),d.playing=!1,e({message:"Sound played.",code:0})};if(l){if(b)try{d.play(),d.currentTime=0}catch(g){d.play()}else d.play();d.playing=!0,d.addEventListener("ended",f,!1)}else e({message:"Sound was muted.",code:-1})},resumeAllSounds:function(){for(var a=c.length-1;a>=0;a--)document.getElementById(c[a]).play()},pauseSound:function(a){document.getElementById(a).pause()},pauseAllSounds:function(){null!=i&&(gkSound.pauseSound(i),c.push(i));for(var b=a.length-1;b>=0;b--)gkSound.pauseSound(a[b].id),1==document.getElementById(a[b].id).playing&&c.push(a[b].id)},stopSound:function(a){var b=document.getElementById(a);try{b.play(),b.currentTime=0,b.pause()}catch(c){b.pause()}},stopAllSounds:function(){null!=i&&(gkSound.stopSound(i),i=null);for(var b=a.length-1;b>=0;b--)gkSound.stopSound(a[b].id)},playTrack:function(){if(l)for(var a=b.length-1;a>=0;a--){document.getElementById(b[a].id).play(),i=b[a].id;break}},stopTrack:function(){null!=i&&(gkSound.stopSound(i),i=null)},toggleSounds:function(){"mute"==localStorage.musicStatus?(l=!0,localStorage.musicStatus="on",document.getElementById(k).innerHTML=m,gkSound.playTrack()):(l=!1,localStorage.musicStatus="mute",document.getElementById(k).innerHTML=n,gkSound.stopAllSounds())},setGlobalVolume:function(c,d){var e;d=d?!0:!1,h=c;for(var f=a.length-1;f>=0;f--)e=d===!0?a[f].volume*h:c,a[f].volume=e;for(var f=b.length-1;f>=0;f--)e=d===!0?b[f].volume*h:c,b[f].volume=e},getGlobalVolume:function(){return h},setVolume:function(a,b,c){c=void 0==c?!1:!0;var d=c===!0?b*h:b;document.getElementById(a).volume=d},getVolume:function(a){return document.getElementById(a).volume}}}();